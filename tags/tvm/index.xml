<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>TVM on Oops</title><link>https://KDZZZZZZ.github.io/tags/tvm/</link><description>Recent content in TVM on Oops</description><generator>Hugo -- 0.152.2</generator><language>en-us</language><lastBuildDate>Tue, 28 Jan 2025 00:00:00 +0800</lastBuildDate><atom:link href="https://KDZZZZZZ.github.io/tags/tvm/index.xml" rel="self" type="application/rss+xml"/><item><title>TVM Function objects and registration implementation</title><link>https://KDZZZZZZ.github.io/posts/tvm%E4%BB%A3%E7%A0%81%E5%BA%93%E8%A7%A3%E6%9E%90%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1%E5%8F%8A%E6%B3%A8%E5%86%8C%E5%AE%9E%E7%8E%B0/</link><pubDate>Tue, 28 Jan 2025 00:00:00 +0800</pubDate><guid>https://KDZZZZZZ.github.io/posts/tvm%E4%BB%A3%E7%A0%81%E5%BA%93%E8%A7%A3%E6%9E%90%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1%E5%8F%8A%E6%B3%A8%E5%86%8C%E5%AE%9E%E7%8E%B0/</guid><description>&lt;p&gt;首先给出TVM中注册自定义函数和调用自定义函数的方法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;// 注册函数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;TVM_REGISTER_GLOBAL(&lt;span style="color:#4070a0"&gt;&amp;#34;add&amp;#34;&lt;/span&gt;).set_body([](TVMArgs args, TVMRetValue&lt;span style="color:#666"&gt;*&lt;/span&gt; ret) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#902000"&gt;int&lt;/span&gt; a &lt;span style="color:#666"&gt;=&lt;/span&gt; args[&lt;span style="color:#40a070"&gt;0&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#902000"&gt;int&lt;/span&gt; b &lt;span style="color:#666"&gt;=&lt;/span&gt; args[&lt;span style="color:#40a070"&gt;1&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#666"&gt;*&lt;/span&gt;ret &lt;span style="color:#666"&gt;=&lt;/span&gt; a &lt;span style="color:#666"&gt;+&lt;/span&gt; b;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;});
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;// 调用函数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;PackedFunc add &lt;span style="color:#666"&gt;=&lt;/span&gt; runtime&lt;span style="color:#666"&gt;::&lt;/span&gt;Registry&lt;span style="color:#666"&gt;::&lt;/span&gt;Get(&lt;span style="color:#4070a0"&gt;&amp;#34;add&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#902000"&gt;int&lt;/span&gt; result &lt;span style="color:#666"&gt;=&lt;/span&gt; add(&lt;span style="color:#40a070"&gt;3&lt;/span&gt;, &lt;span style="color:#40a070"&gt;5&lt;/span&gt;); &lt;span style="color:#60a0b0;font-style:italic"&gt;// 返回 8
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;TVM实现注册Lambda函数的&lt;code&gt;set_body&lt;/code&gt;函数是一个指向&lt;code&gt;PackedFunc&lt;/code&gt;类型的指针.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TVM_REGISTER_GLOBAL&lt;/code&gt;的实现如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#007020"&gt;#define REGISTER_GLOBAL(name, func) \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#007020"&gt; tvm::runtime::FRegistry::Register(name, tvm::runtime::PackedFunc(func))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用全局哈希表&lt;code&gt;FRegistry&lt;/code&gt;注册函数。通过宏&lt;code&gt;REGISTER_GLOBAL(&amp;quot;func_name&amp;quot;, MyFunction)&lt;/code&gt;将函数与名称绑定，后续通过&lt;code&gt;GetPackedFunc(&amp;quot;func_name&amp;quot;)&lt;/code&gt;查找.&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;REGISTER_GLOBAL&lt;/code&gt;宏将函数与名称绑定。这个宏会调用&lt;code&gt;FRegistry::Register&lt;/code&gt;方法，将函数存储到全局哈希表中。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PackedFunc&lt;/code&gt;类型继承自&lt;code&gt;ObjectRef&lt;/code&gt;基类，实现了运算符重载，又用&lt;code&gt;make_object&lt;/code&gt;函数创建一个&lt;code&gt;PackedFuncSubObj&lt;/code&gt;类型对象，这个对象可以储存可调用对象.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PackedFuncSubObj&lt;/code&gt;继承自&lt;code&gt;PackedFuncObj&lt;/code&gt;, 这是&lt;code&gt;Object&lt;/code&gt;的子类，&lt;code&gt;Object&lt;/code&gt;实现了引用计数和类型检查，&lt;code&gt;PackedFunObj&lt;/code&gt;对函数指针、参数和返回值指针进行了打包。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PackedFuncSubObj&lt;/code&gt;类型用&lt;code&gt;std::remove_reference&lt;/code&gt;和&lt;code&gt;std::remove_cv&lt;/code&gt;进行了类型擦除，对&lt;code&gt;const&lt;/code&gt;、&lt;code&gt;volatile&lt;/code&gt;和引用进行去壳，移除我们不需要的特性.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PackedFuncSubObj&lt;/code&gt;中定义了&lt;code&gt;Extractor&lt;/code&gt;提取器结构，提取器内部的&lt;code&gt;Call&lt;/code&gt;函数是一个指针，用来调用可调用对象。&lt;/p&gt;
&lt;p&gt;接下来解释一下参数和返回值的数据结构。&lt;/p&gt;
&lt;p&gt;分别是&lt;code&gt;TVMArgs&lt;/code&gt;和&lt;code&gt;TVMRetValue&lt;/code&gt;,都使用了联合体&lt;code&gt;TVMValue&lt;/code&gt;对数据进行打包并进行了运算符重载和用于数据传递的基本方法。&lt;/p&gt;
&lt;p&gt;以上所有的实现基本都在&lt;code&gt;include/tvm/runtime/packed_func.h&lt;/code&gt;、&lt;code&gt;include/tvm/runtime/registry.h&lt;/code&gt;和&lt;code&gt;src/runtime/registry.cc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Python&lt;/code&gt;封装了&lt;code&gt;ctypes&lt;/code&gt;库，能够通过&lt;code&gt;name&lt;/code&gt;查找全局注册的C++函数并获得函数句柄，调用后得到传回的返回值。
其中对数据类型的包装也是TVM实现任意语言互相调用的关键.&lt;/p&gt;</description></item><item><title>TVM代码库解析：Relay层结构与优化Pass</title><link>https://KDZZZZZZ.github.io/posts/tvm%E4%BB%A3%E7%A0%81%E5%BA%93%E8%A7%A3%E6%9E%90relay%E5%B1%82%E7%BB%93%E6%9E%84%E4%B8%8E%E4%BC%98%E5%8C%96pass/</link><pubDate>Tue, 28 Jan 2025 00:00:00 +0800</pubDate><guid>https://KDZZZZZZ.github.io/posts/tvm%E4%BB%A3%E7%A0%81%E5%BA%93%E8%A7%A3%E6%9E%90relay%E5%B1%82%E7%BB%93%E6%9E%84%E4%B8%8E%E4%BC%98%E5%8C%96pass/</guid><description>&lt;p&gt;relay层主要由数据结构类(如Constant)和节点类(如ConstantNode)组成。
下面梳理一下他们的继承链。&lt;/p&gt;
&lt;p&gt;ObjectRef → BaseExpr → RelayExpr → Constant&lt;/p&gt;
&lt;p&gt;Object → BaseExprNode → RelayExprNode → ConstantNode&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;源代码库中使用了&lt;code&gt;using ExprNode = tvm::RelayExprNode;&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这里先赘述一下上面每个类的的功能：&lt;/p&gt;
&lt;h4 id="1"&gt;&lt;strong&gt;(1) &lt;code&gt;Object&lt;/code&gt; (include/tvm/runtime/object.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;TVM &lt;strong&gt;所有对象的基类&lt;/strong&gt;，提供 &lt;strong&gt;引用计数&lt;/strong&gt; 和 &lt;strong&gt;类型系统&lt;/strong&gt; 支持&lt;/li&gt;
&lt;li&gt;实现 &lt;code&gt;RefCount&lt;/code&gt; 机制（通过 &lt;code&gt;use_count&lt;/code&gt; 成员）&lt;/li&gt;
&lt;li&gt;提供 &lt;code&gt;type_index&lt;/code&gt; 用于运行时类型识别（RTTI）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;关键方法&lt;/strong&gt;：
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;virtual&lt;/span&gt; &lt;span style="color:#902000"&gt;uint32_t&lt;/span&gt; &lt;span style="color:#06287e"&gt;type_index&lt;/span&gt;() &lt;span style="color:#007020;font-weight:bold"&gt;const&lt;/span&gt;; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 类型标识
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;&lt;span style="color:#902000"&gt;void&lt;/span&gt; &lt;span style="color:#06287e"&gt;IncRef&lt;/span&gt;(); &lt;span style="color:#60a0b0;font-style:italic"&gt;// 增加引用计数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;&lt;span style="color:#902000"&gt;void&lt;/span&gt; &lt;span style="color:#06287e"&gt;DecRef&lt;/span&gt;(); &lt;span style="color:#60a0b0;font-style:italic"&gt;// 减少引用计数
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2"&gt;&lt;strong&gt;(2) &lt;code&gt;ObjectRef&lt;/code&gt; (include/tvm/runtime/object.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;所有 &lt;strong&gt;对象引用&lt;/strong&gt; 的基类模板（如 &lt;code&gt;Constant&lt;/code&gt; 本质是 &lt;code&gt;ObjectRef&amp;lt;ConstantNode&amp;gt;&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;通过智能指针 (&lt;code&gt;ObjectPtr&lt;/code&gt;) &lt;strong&gt;管理 Object 子类的生命周期&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;提供 &lt;strong&gt;类型安全转换接口&lt;/strong&gt;（如 &lt;code&gt;as&amp;lt;T&amp;gt;()&lt;/code&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;关键行为&lt;/strong&gt;：
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;template&lt;/span&gt;&lt;span style="color:#666"&gt;&amp;lt;&lt;/span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;typename&lt;/span&gt; T&lt;span style="color:#666"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;const&lt;/span&gt; T&lt;span style="color:#666"&gt;*&lt;/span&gt; as() &lt;span style="color:#007020;font-weight:bold"&gt;const&lt;/span&gt;; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 安全类型转换
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;operator&lt;/span&gt; &lt;span style="color:#06287e"&gt;bool&lt;/span&gt;() &lt;span style="color:#007020;font-weight:bold"&gt;const&lt;/span&gt;; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 检查是否非空
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="3"&gt;&lt;strong&gt;(3) &lt;code&gt;BaseExprNode&lt;/code&gt; (include/tvm/ir/expr.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;继承关系&lt;/strong&gt;：&lt;code&gt;Object&lt;/code&gt; → &lt;code&gt;BaseExprNode&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;所有 &lt;strong&gt;表达式节点&lt;/strong&gt; 的抽象基类&lt;/li&gt;
&lt;li&gt;定义表达式通用接口：
&lt;ul&gt;
&lt;li&gt;数据类型 (&lt;code&gt;dtype&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;源码位置 (&lt;code&gt;span&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;虚函数 &lt;code&gt;SEqualReduce&lt;/code&gt;（用于结构相等性比较）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;关键成员&lt;/strong&gt;：
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;runtime&lt;span style="color:#666"&gt;::&lt;/span&gt;DataType dtype; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 数据类型（如 float32）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;Span span; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 源码位置信息（用于调试）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="4"&gt;&lt;strong&gt;(4) &lt;code&gt;BaseExpr&lt;/code&gt; (include/tvm/ir/expr.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;继承关系&lt;/strong&gt;：&lt;code&gt;ObjectRef&lt;/code&gt; → &lt;code&gt;BaseExpr&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;所有 &lt;strong&gt;表达式引用&lt;/strong&gt; 的基类（如 &lt;code&gt;Constant&lt;/code&gt;、&lt;code&gt;Var&lt;/code&gt; 等）&lt;/li&gt;
&lt;li&gt;提供对 &lt;code&gt;BaseExprNode&lt;/code&gt; 的通用访问接口&lt;/li&gt;
&lt;li&gt;重载运算符（如 &lt;code&gt;operator==&lt;/code&gt;）实现表达式比较&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="5"&gt;&lt;strong&gt;(5) &lt;code&gt;RelayExprNode&lt;/code&gt; (include/tvm/ir/expr.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;继承关系&lt;/strong&gt;：&lt;code&gt;BaseExprNode&lt;/code&gt; → &lt;code&gt;RelayExprNode&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Relay 表达式体系的节点基类&lt;/strong&gt;，定义所有高层计算图节点的通用行为&lt;/li&gt;
&lt;li&gt;存储 Relay 特有的元数据：
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;类型信息&lt;/strong&gt; (&lt;code&gt;checked_type_&lt;/code&gt;): 类型推断后的结果（如 &lt;code&gt;TensorType(shape=[1,3], dtype=float32)&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;源码位置&lt;/strong&gt; (&lt;code&gt;span&lt;/code&gt;): 用于调试和错误定位&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;实现 &lt;strong&gt;结构等价性检查&lt;/strong&gt; (&lt;code&gt;SEqualReduce&lt;/code&gt;) 和 &lt;strong&gt;哈希生成&lt;/strong&gt; (&lt;code&gt;SHashReduce&lt;/code&gt;) 的虚函数&lt;/li&gt;
&lt;li&gt;支持 &lt;strong&gt;递归遍历子节点&lt;/strong&gt; 的接口（用于优化 Pass 或分析）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;关键成员&lt;/strong&gt;：
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#007020;font-weight:bold"&gt;mutable&lt;/span&gt; Type checked_type_; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 类型推断结果（可缓存）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;Span span; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 源码位置信息
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;典型子类&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ConstantNode&lt;/code&gt;（常量）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;VarNode&lt;/code&gt;（变量）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CallNode&lt;/code&gt;（函数调用）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FunctionNode&lt;/code&gt;（函数定义）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="6"&gt;&lt;strong&gt;(6) &lt;code&gt;RelayExpr&lt;/code&gt; (include/tvm/ir/expr.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;继承关系&lt;/strong&gt;：&lt;code&gt;BaseExpr&lt;/code&gt; → &lt;code&gt;RelayExpr&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;通过&lt;code&gt;TVM_DEFINE_OBJECT_REF_METHODS&lt;/code&gt;宏定义了对象引用管理、类型转换和节点访问的功能&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="7"&gt;&lt;strong&gt;(7) &lt;code&gt;ConstantNode&lt;/code&gt; (include/tvm/relay/expr.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;继承关系&lt;/strong&gt;：&lt;code&gt;RelayExprNode&lt;/code&gt; → &lt;code&gt;ConstantNode&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;存储常量数据的节点&lt;/strong&gt;（具体实现）&lt;/li&gt;
&lt;li&gt;持有 &lt;code&gt;runtime::NDArray&lt;/code&gt; 表示常量值&lt;/li&gt;
&lt;li&gt;实现 &lt;code&gt;SEqualReduce&lt;/code&gt; 比较常量值是否相等&lt;/li&gt;
&lt;li&gt;实现 &lt;code&gt;SHashReduce&lt;/code&gt; 生成哈希值&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;关键成员&lt;/strong&gt;：
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;runtime&lt;span style="color:#666"&gt;::&lt;/span&gt;NDArray data; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 常量数据（可以是标量或张量）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="8"&gt;&lt;strong&gt;(8) &lt;code&gt;Constant&lt;/code&gt; (include/tvm/relay/expr.h)&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;继承关系&lt;/strong&gt;：&lt;code&gt;RelayExpr&lt;/code&gt; → &lt;code&gt;Constant&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;功能&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;用户直接使用的常量包装类&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;构造函数封装 &lt;code&gt;ConstantNode&lt;/code&gt; 的创建&lt;/li&gt;
&lt;li&gt;提供对 &lt;code&gt;data&lt;/code&gt; 的安全访问方法&lt;/li&gt;
&lt;li&gt;示例用法：
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-cpp" data-lang="cpp"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;NDArray arr &lt;span style="color:#666"&gt;=&lt;/span&gt; ...;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;Constant c &lt;span style="color:#666"&gt;=&lt;/span&gt; Constant(arr); &lt;span style="color:#60a0b0;font-style:italic"&gt;// 创建常量
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#60a0b0;font-style:italic"&gt;&lt;/span&gt;Expr expr &lt;span style="color:#666"&gt;=&lt;/span&gt; c; &lt;span style="color:#60a0b0;font-style:italic"&gt;// 可隐式转换为基类
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有了对基类的功能认识，我们只需要继续了解类似&lt;code&gt;Constant&lt;/code&gt;和&lt;code&gt;ConstantNode&lt;/code&gt;类的其他主要类实现。&lt;/p&gt;</description></item></channel></rss>